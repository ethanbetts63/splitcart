# Data Processing and Archiving Pipeline

This document outlines the current data processing pipeline, from raw data collection to the generation of final, sellable data archives.

## Implemented Stages

The pipeline consists of several automated stages that process raw data and populate the central database, followed by a process to generate company-level archives.

### Stage 1: Store Database Population
*   **Command:** `python manage.py update_store_database`
*   **Purpose:** This command processes raw JSON files containing store information from the `api/data/discovered_stores/` directory.
*   **Process:** It reads each file, creates or updates the corresponding `Company`, `Division`, and `Store` records in the database, and then deletes the source file. This ensures the central database always has the most up-to-date store information.

### Stage 2: Product Database Population
*   **Command:** `python manage.py update_database`
*   **Purpose:** This command populates the database with product and price information from processed data files located in `api/data/processed_data/`.
*   **Process:** For each file, it deactivates old prices for the relevant store, then creates or updates `Product` records and adds the new `Price` information. This command maintains a live, relational database of all products and their current prices.

### Stage 3: Company Archive Generation
*   **Command:** `python manage.py build_company_jsons`
*   **Purpose:** This command generates the first set of sellable data archives.
*   **Process:** It queries the database and creates aggregated JSON files for each company (e.g., `coles.json`, `woolworths.json`) in the `api/data/archive/company_data/` directory. These files contain detailed lists of all stores belonging to each company, grouped by division.

## Future Work: Product Archives

The final piece of the archiving system, the generation of per-store **product archives**, has not yet been built.

*   **Concept:** These archives will be individual JSON files for each store (e.g., `archive/store_data/coles/{store-slug}.json`).
*   **Contents:** Each file will contain:
    *   Metadata about the specific store.
    *   A complete list of all products available at that store.
    *   A full price history for each product at that store.
    *   A hierarchical representation of the store's specific product categories.

This represents the remaining work required to complete the full suite of planned sellable data products.