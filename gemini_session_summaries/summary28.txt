### 4. Substitution System Simplification and Renumbering

We undertook a significant simplification of the product substitution system. After analyzing the logic of Level 3, 4, 5, and 6 substitution generators, we determined that Levels 3 and 4 (which used TF-IDF for textual similarity) were redundant, as their functionality was a less effective subset of what Level 5 (using Sentence Transformers for semantic similarity) already accomplished. Level 6, which finds semantic matches across linked categories, was deemed complementary and unique.

Based on this analysis, the following changes were implemented:

- **Removal of Redundant Levels:** The `lvl3_substitution_generator.py` and `lvl4_substitution_generator.py` files were deleted.
- **Renumbering of Semantic Levels:** The former Level 5 (Semantic Similarity) was renumbered to Level 3, and the former Level 6 (Linked Category Semantic Similarity) was renumbered to Level 4. This involved:
    - Renaming the corresponding generator files (`lvl5_substitution_generator.py` to `lvl3_substitution_generator.py`, and `lvl6_substitution_generator.py` to `lvl4_substitution_generator.py`).
    - Updating class names, level parameters, comments, and log messages within these renamed files.
- **Codebase-Wide Reference Updates:** All references to the old level numbers and generator names were updated across the codebase, including:
    - The `ProductSubstitution` model (`products/models/substitution.py`) to reflect the new `SUBSTITUTION_LEVELS` choices and default value.
    - The `generate_subs` management command (`api/management/commands/generate_subs.py`) to use the new imports, command-line arguments, and generator calls.
    - The `savings_benchmark` analysis script (`api/utils/analysis_utils/savings_benchmark.py`) to update its `transitive_levels` list.
    - The `savings_calculation_explanation.txt` documentation to reflect the updated substitution level descriptions.
- **Defensive Code Removal:** A piece of defensive programming code in `api/utils/analysis_utils/substitution_breakdown.py` that manually added levels to a list was removed, as it is no longer necessary given the consistent model definition.