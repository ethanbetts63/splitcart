# Store Grouping and Price Optimization Strategy

The goal of this strategy is to avoid scraping every store every day by intelligently grouping stores that share common pricing and product ranges.

## Core Concept: Store "Fingerprinting"

The central idea is to create a "fingerprint" for a store based on a small, representative sample of its data. If two stores have the same fingerprint, we can tentatively place them in the same price group. This avoids the need for a full initial scrape of every store.

## Key Challenges & Solutions

### 1. Different Product Ranges

**Problem:** Stores within the same price group might not stock the exact same items.

**Solution:** Decouple price grouping from product availability.

*   **Price Groups:** A group of stores that share a common pricing scheme. We only need to do a full price/product scrape on *one* representative "master" store from this group to get the prices for all products available within that group.
*   **Availability Profiles:** For each individual store, we maintain a separate, lightweight record of the products it actually stocks. This can be updated less frequently than prices.

### 2. Category-Specific Pricing

**Problem:** Pricing for certain categories (e.g., pantry goods) may be consistent nationally, while others (e.g., fresh produce) may vary regionally.

**Solution:** Start with store-level grouping and evolve if necessary.

*   **Initial Approach:** Group stores based on their overall price fingerprint. This is simpler to implement initially.
*   **Future Evolution:** If data shows significant variance, we can move to a more granular model where a store can belong to different price groups for different product categories.

### 3. Discovering Groups Without a Full Initial Scrape (The Bootstrapping Problem)

**Problem:** We need to assign stores to groups without scraping all of them first.

**Solution:** The "Basket of Goods" Fingerprint.

1.  **Define a "Basket":** Select a static list of 20-50 diverse products. This basket should include:
    *   Common national brands (e.g., Coca-Cola, Colgate toothpaste).
    *   Common store-brands (e.g., Coles home-brand milk).
    *   Items from various categories (pantry, fresh, frozen).
    *   Items known to have price volatility.

2.  **Fingerprint Scrape:** To classify a new or unknown store, we run a very fast, targeted scrape that *only* fetches the prices for the items in our "Basket of Goods".

3.  **Create the Fingerprint:** Generate a unique identifier (like a hash or a concatenated string) from the product IDs and their prices (e.g., `product1:price1;product2:price2;...`). This is the store's fingerprint.

4.  **Grouping:**
    *   When a new store is fingerprinted, compare its fingerprint to a list of known fingerprints.
    *   **Match:** If it matches an existing fingerprint, add the store to that `PriceGroup`.
    *   **No Match:** If the fingerprint is new, this store becomes the "master" store for a new `PriceGroup`. It then gets a full scrape to establish the complete price and product data for this new group.

## Proposed Workflow

1.  **Seeding:** Manually select 3-5 geographically diverse stores (e.g., Perth CBD, regional WA, Sydney CBD). Perform a full scrape on them to create the initial "master" stores for the first `PriceGroups`.

2.  **Discovery:** For any new store found, run the lightweight "Basket of Goods" scrape to get its fingerprint.

3.  **Assignment:** Compare the fingerprint to existing groups. Assign the store to a matching group or create a new one with this store as its master.

4.  **Maintenance:**
    *   **Daily:** Perform a full scrape on the "master" store of each `PriceGroup` to update prices.
    *   **Weekly/Monthly (Verification):**
        *   To prevent "drift," pick a *random* non-master store from each group and run a full scrape on it. If its prices have diverged from the master, it needs to be re-fingerprinted and potentially moved to a new group.
        *   Run a lightweight, availability-only scrape on non-master stores to keep their individual product ranges up-to-date.
