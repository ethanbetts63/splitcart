This document traces the execution flow of the cart optimization feature, from the initial API request to the final response.

File: `api/views/cart_optimization_view.py`

The process begins here, in the `CartOptimizationView`. This file is responsible for handling the incoming POST request from the frontend. It receives the user's cart, which is a list of products, and a list of store IDs to consider for the optimization. The view then calls upon several utility functions to process this data. It first calls `build_price_slots` to structure the data for the optimizer, then `calculate_optimized_cost` to run the optimization algorithm, and `calculate_baseline_cost` to determine the cost if the user were to shop at a single store. Finally, it formats the results and sends them back as the API response.

File: `data_management/utils/cart_optimization/build_price_slots.py`

This is the next step in the chain. The `build_price_slots` function takes the raw cart data and the list of stores and transforms it into a data structure that the optimization algorithm can understand. For each item in the cart, it finds all the available prices at the specified stores. The output is a list of "slots," where each slot represents a product in the cart and contains a list of all the purchasing options (prices at different stores) for that product. The structure of these slots is critical for the optimizer to work correctly.

File: `data_management/utils/cart_optimization/calculate_optimized_cost.py`

This file contains the core of the optimization logic. It uses the PuLP library to solve a linear programming problem. It takes the `price_slots` generated in the previous step and determines the cheapest combination of products from different stores, while respecting the constraint on the maximum number of stores to visit. The output of this function is the total optimized cost and the detailed shopping plan, which specifies which products to buy at which stores.

File: `data_management/utils/cart_optimization/calculate_baseline_cost.py`

This function is called by the `CartOptimizationView` to provide a point of comparison for the optimized cost. It calculates what the total cost would be if the user were to purchase all the items in their cart from a single, cheapest store that has all the items. This baseline cost is then compared against the optimized cost to show the user how much they are saving.
