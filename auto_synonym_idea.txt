## Idea: Automatic Brand Synonym Generation from Barcode Matches

**Concept:**
Leverage barcode matches during the `update_db` process to automatically discover and save brand name synonyms. When a new product is scraped with a barcode that already exists in the database, we can treat this as a confirmed match and a source of truth.

**Trigger Point:**
The logic will be triggered within the `update_db` management command at the moment a new, incoming product from the product_inbox is found to have the same barcode as a product already existing in the database.

**Proposed Logic:**
1.  When a barcode match is identified, the system will perform a check to compare the brand of the incoming product with the brand of the existing product.
2.  To ensure accuracy, the brands will be cleaned (lowercased, whitespace stripped) before comparison.
3.  If the cleaned brand names are different, the system will automatically create a new synonym mapping.
4.  The brand of the existing product will be treated as the canonical name, and the brand of the new product will be the synonym.
5.  **Initial Implementation:** This new mapping will be appended to a *separate* file, `api/data/analysis/auto_generated_brand_synonyms.json`, for review and testing purposes.

**Example Workflow:**
1.  **Existing Product in DB:**
    - Barcode: `9300675009753`
    - Brand: `Coca-Cola`
2.  **Incoming Scraped Product:**
    - Barcode: `9300675009753`
    - Brand: `Coke`
3.  **`update_db` Execution:**
    - A barcode match is found.
    - The system compares `clean('Coke')` and `clean('Coca-Cola')` and finds them to be different.
    - It automatically appends the synonym `{"Coke": "Coca-Cola"}` to `api/data/analysis/auto_generated_brand_synonyms.json`.
    - It then proceeds with its normal function of adding the new price to the existing `Coca-Cola` product.

**Benefits:**
-   **Automated Learning:** Continuously and automatically improves the brand normalization data without manual intervention.
-   **Increased Accuracy:** Leverages the most reliable product identifier (the barcode) to create high-confidence synonyms.
-   **Improved Matching:** The enriched synonym list will improve product matching for non-barcoded items from other stores.

**Safeguards & Further Considerations:**
-   **Separate File for Review:** Saving to `auto_generated_brand_synonyms.json` allows for manual review and curation of these automatically generated synonyms before they are potentially merged into the main `brand_synonyms.py` file. This mitigates the risk of incorrect barcode data introducing bad synonyms.
-   **File Format:** Using a JSON file (`.json`) for `auto_generated_brand_synonyms` is recommended for easier programmatic reading and writing compared to a Python (`.py`) file.
-   **Conflict Resolution:** Before adding a new auto-generated synonym, the system should check for existing manual synonyms (in `brand_synonyms.py`) or existing rules (in `brand_rules.json`). If a conflict is detected (e.g., the auto-generated synonym contradicts an existing manual entry or rule), the auto-generation should be skipped, and the conflict should be logged. Manual entries/rules should always take precedence.
-   **Detailed Logging:** Reinforce the need for detailed logging of every auto-generated synonym (and any skipped conflicts) to a dedicated log file (e.g., `auto_synonyms.log`). This log should include the source product details (barcode, original brands, product names) to aid in debugging and verification.
-   **Brand Cleaning:** Reiterate the importance of consistently cleaning brand names using `clean_value` before comparison and before adding to the synonym file to ensure accurate matching and prevent redundant entries.

**Some Relevant File Paths:**
-   `api/management/commands/update_db.py`: The main management command that orchestrates the database update process.
-   `api/utils/database_updating_utils/batch_create_new_products.py`: Contains the core logic for matching products, including barcode matching, where the auto-synonym generation logic will be implemented.
-   `api/utils/normalization_utils/clean_value.py`: Utility function for cleaning and normalizing string values, crucial for consistent brand comparisons.
-   `api/data/analysis/brand_synonyms.py`: The primary file containing manually curated brand synonyms. Auto-generated synonyms will eventually be merged here after review.
-   `api/data/analysis/brand_rules.json`: Stores conditional brand rules, which need to be considered during conflict resolution for auto-generated synonyms.
-   `api/data/analysis/auto_generated_brand_synonyms.json`: The new, temporary file where automatically generated synonyms will be stored for initial review and testing.
-   `auto_synonyms.log`: A dedicated log file to record details of all auto-generated synonyms, including any conflicts or skipped entries, for auditing and debugging purposes.
